package com.app.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import com.app.dto.CourseDTO;
import com.app.entities.Course;
import com.app.repository.CourseRepository;

import io.jsonwebtoken.io.IOException;


@Service
@Transactional
public class CourseServiceImpl implements CourseService {

	@Autowired
    private CourseRepository courseRepository;

    @Autowired
    private CloudinaryService cloudinaryService;
	@Override
	public Course createCourse(CourseDTO courseDTO, MultipartFile thumbnailFile) throws IOException {
		Course course = new Course();
        course.setTitle(courseDTO.getTitle());
        course.setDescription(courseDTO.getDescription());
        course.setCategory(courseDTO.getCategory());
        course.setCreatedBy(courseDTO.getCreatedBy());

        if (thumbnailFile != null && !thumbnailFile.isEmpty()) {
            Map<String, Object> uploadResult = cloudinaryService.uploadImage(thumbnailFile);
            Thumbnail thumbnail = new Thumbnail();
            thumbnail.setPublicId((String) uploadResult.get("public_id"));
            thumbnail.setSecureUrl((String) uploadResult.get("secure_url"));
            course.setThumbnail(thumbnail);
        }

        return courseRepository.save(course);
	}

}
